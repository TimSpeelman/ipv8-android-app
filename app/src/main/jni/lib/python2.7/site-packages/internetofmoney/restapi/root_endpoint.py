from twisted.web import resource

from internetofmoney.restapi.banks_endpoint import BanksEndpoint
from internetofmoney.restapi.events_endpoint import DBEventsEndpoint, EventsEndpoint
from internetofmoney.restapi.input_endpoint import InputEndpoint
from internetofmoney.restapi.log_endpoint import LogEndpoint
from internetofmoney.restapi.password_endpoint import PasswordEndpoint
from internetofmoney.restapi.services_endpoint import ServicesEndpoint
from internetofmoney.restapi.transactions_endpoint import TransactionsEndpoint
from internetofmoney.restapi.unlock_endpoint import UnlockEndpoint


class RootEndpoint(resource.Resource):
    """
    The root endpoint of the IoM HTTP API is the root resource in the request tree.
    It will dispatch requests to the right child endpoint.
    """

    def __init__(self, session):
        resource.Resource.__init__(self)
        self.putChild("log", LogEndpoint(session.cache_dir))
        self.putChild("db_events", DBEventsEndpoint(session.database))
        self.putChild("transactions", TransactionsEndpoint(session.database))
        self.putChild("banks", BanksEndpoint(session))
        self.putChild("input", InputEndpoint(session))
        self.putChild("unlock", UnlockEndpoint(session))
        self.putChild("password", PasswordEndpoint(session))

        self.events_endpoint = EventsEndpoint(session)
        self.putChild("events", self.events_endpoint)

        if session.is_switch:
            self.putChild("services", ServicesEndpoint(session.money_community))
