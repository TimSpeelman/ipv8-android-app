import json
import os

from twisted.web import http
from twisted.web import resource

from internetofmoney.utils.exceptions import WrongPasswordException


class PasswordEndpoint(resource.Resource):
    """
    This class is handles operations with passwords for the Internet-of-Money module.
    """

    def __init__(self, session):
        resource.Resource.__init__(self)
        self.session = session

    def render_POST(self, request):
        """
        Set the wallet password.
        """
        parameters = http.parse_qs(request.content.read(), 1)
        if 'password' not in parameters:
            request.setResponseCode(http.BAD_REQUEST)
            return json.dumps({"error": "password parameter missing"})

        self.session.set_password(parameters['password'][0])

        return json.dumps({'success': True})
