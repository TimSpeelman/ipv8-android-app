from internetofmoney.tests.restapi.base_api_test import AbstractApiTest
from internetofmoney.tests.util.twisted_thread import deferred


class TestUnlockEndpoint(AbstractApiTest):
    """
    This class contains tests for the password endpoint.
    """

    @deferred(timeout=10)
    def test_unlock_no_param(self):
        """
        Test unlocking the session withing specifying a parameter using the RESTful API
        """
        self.should_check_equality = False
        return self.do_request('unlock', request_type='POST', expected_code=400)

    @deferred(timeout=10)
    def test_unlock_wrong_pw(self):
        """
        Test unlocking the session with a wrong password using the RESTful API
        """
        self.session.is_locked = True
        return self.do_request('unlock', request_type='POST', post_data={'password': 'abc'}, expected_code=401)

    @deferred(timeout=10)
    def test_unlock(self):
        """
        Test unlocking the session using the RESTful API
        """
        self.session.is_locked = True
        return self.do_request('unlock', request_type='POST', post_data={'password': 'abcd'},
                               expected_code=200, expected_json={'success': True})
